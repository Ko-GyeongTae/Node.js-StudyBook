# 1장에서 배울 내용

* 노드란 무엇인가?
* 어디에 쓰이는가?
* 누가 쓰는가?
* 노드의 핵심 개념이란?

---
# 1.1 핵심개념 이해하기
    Node.js 는 Chrome V8 Javascript 엔진으로 빌드된 Javascript 런타임이다.

    서버 혹은 자바스크립트 프로그램을 실행하는데 사용할 수 있다.

## 1.1.1 서버
*노드는 서버 어플리케이션을 실행하는데 제일 많이 사용한다.<br>*
> 서버란 무엇인가?
>> 서버는 네트워크를 통해 클라이언트에 정보나 서비스를 제공하는 컴퓨터 또는 프로그램을 말한다.

> 클라이언트는 무엇인가?
>> 클라이언트란 요청을 보내는 주체로 브라우저, 데스크톱 프로그램, 모바일 앱, 요청을 보내는 서버일 수도 있다.

## *정리*
### 서버는 클라이언트의 요청에 대해 응답을 한다.
> 응답은 항상 YES? 
>> 항상 Yes를 응답해야하는 것은 아니고 No를 할 수도 있다.
---

## 1.1.2 자바스크립트 런타임
> 노드는 자바스크립트 런타임이다.
>> 런타임은 특정 언어로 만든 프로그램들을 실행할 수 있는 "환경"을 뜻한다.<br>
>> 따라서 노드는 자바스크립트 프로그램을 컴퓨터에서 실행할 수 있다.

### *__"노드는 자바스크립트 실행기라고 봐도 무방하다."__*

    기존에는 자바스크립트 프로그램을 웹 브라우저 위에서만 실행할 수 있었다.
    브라우저 외의 환경에서 실행하기 위한 여러 시도가 있었으나, 실행 속도 문제로 큰 호응을 얻지는 못하였다.

    하지만 2008년 구글이 V8엔진을 사용하여 크롬을 출시한 후 오픈소스로 코드를 공개했다.

    속도 문제가 해결되자 라이언 달은 2009년 V8엔진 기반 노드 프로젝트를 시작했다.

### 노드의 내부 구조

| 노드의 내부 구조 |
| --- |
| Node.js Core Library |
| Node.js Bindings |
| V8 & libuv |
<br>

> V8
>> 오픈 소스 자바스크립트 엔진

> libuv
>> 비동기 I/O

    노드는 V8과 더불어 libuv라는 라이브러리를 사용한다. V8과 libuv는 C와 C++로 구현되어 있다.
    
    libuv 라이브러리는 노드의 특성인 "이벤트 기반", "논 블로킹 I/O" 모델을 구현하고 있다.

## 1.1.3 이벤트 기반

> *__이벤트 기반(event-driven)이란?__*
>> 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미한다. <br>
>> 이벤트로는 클릭이나 네트워크 요청 등이 있을 수 있다.

> *__이벤트 리스너(event listener)와 콜백(callback)함수란?__*
>> 이벤트 기반 시스템에서는 특정 이벤트가 발생할 때 무엇을 할지 미리 등록해두어야야 하는데 이를 이벤트 리스너에 콜백 함수를 등록한다고 표현한다.<br>
>> 클릭 이벤트 리스너에 경고창을 띄우는 콜백함수를 등록해두면 클릭 이벤트가 발생할 때마다 콜백 함수가 실행되는 것이다.

*__Tip__*

    노드도 이벤트 기반 방식으로 동작하므로, 이벤트가 발생하면 리스너에 등록해둔 콜백함수를 호출한다.

    발생한 이벤트가 없거나 다 처리했다면 노드는 다음 이벤트가 발생할 때까지 대기한다.

## *이벤트 기반 모델에서는 이벤트 루프(event loop)라는 개념이 등장한다.*
    여러 이벤트가 동시에 발생했을 때 어떤 순서로 콜백 함수를 호출할지를 이벤트 루프가 판단한다.

```javascript
function first(){
    second();
    console.log('첫 번째');
}

function second(){
    third();
    console.log('두 번째');
}

function third(){
    console.log('세 번째');
}

first();
```

실행후
```
세 번째 
두 번째
첫 번째
```

*쉽게 파악하는 방법 -> 함수 호출 스택을 그려보자*

```javascript
function run(){
    console.log('3초 후 실행');
}

console.log('시작');
setTimeout(run, 3000);
console.log('끝');
```
결과
```
시작
끝
3초 후 실행
```

### 해설
    3초 후 run 함수를 실행하는 코드이다. 콘솔 결과는 쉽게 예측할 수 있지만, 호출 스택으로 설명하기는 힘들다. setTimeout 함수의 콜백인 run이 호출 스택에 언제들어가는지 쉽게 파악할 수 없기 때문이다.
    이를 파악하기 위해서는 이벤트 루프, 태스크 큐, 백그라운드에 대해 알아야 한다.

*__이벤트 루프__*<br>
이벤트 발생시 호출할 콜백 함수들을 관리하고, 호출된 콜백 함수의 실행 순서를 결정하는 역할을 담당한다. 노드가 종료될 때까지 이벤트 처리를 위한 작업을 반복하므로 루프(loop)라고 부른다.

*__백그라운드__*<br>
setTimeout같은 타이머나 이벤트 리스너들이 대기하는 곳이다. 자바스크립트가 아닌 다른 언어로 작성된 프로그램이라고 봐도 된다. 여러 작업이 동시에 실행될 수 있다.

*__태스크 큐__*<br>
이벤트 발생 후, 백그라운드에서는 태스크 큐로 타이머나 이벤트 리스너의 콜백함수를 보낸다. 정해진 순서대로 콜백들이 줄을 서 있으므로 콜백 큐라고도 부른다. 콜백들은 보통 완료된 순서대로 줄을 서 있으나 특정한 경우에는 순서가 바뀌기도 한다.

    호출 스택에 함수들이 너무 많이 쌓여 있으면 3초가 지난 후에도 run 함수가 실행되지 않을 수 있다. 이벤트 루프는 호출 스택이 비어 있을 때만 태스크 큐에 있는 run 함수를 호출스택으로 가져오기 때문이다. 이것이 setTimeout의 시간이 정확하지 않을 수도 있는 이유이다.




